{% extends "layout.html" %}

{% block head %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
{% endblock %}

{% block header %}
    <div class="login">
    {% if session %}
        <h2 class="login_info">{{session.userinfo.name}}</h2>
        <img class="login_info" src="{{ session['userinfo']['picture'] }}" alt="User Google Profile Picture" >
        <p class="login_info" class="logout_button"><a href="/logout">Logout</a></p>
    {% else %}
        <h2 class="login_info">Welcome Guest</h1>
        <p class="login_info"><a href="/login">Login</a></p>
    {% endif %}
    </div>

    <h1>Coin Canvas</h1>
{% endblock %}

{% block body %}

    <form method="post" action="/api">
        <input type="text" name="query" autofocus autocomplete="off" placeholder="Search for a Coin or Stock (e.g. BTC)">
        <input type="radio" name="type" value="Stock" required> Stock
        <input type="radio" name="type" value="Crypto" required> Crypto
        <input type="submit">
    </form>

{% if errortext %}

    <div>{{errortext}}</div>

{% endif %}

{% if graphs %}

<div class="timeframeBox">
    <form action="/" method="get">
        <input type="submit" value="3" name="timeframe">Days
        <input type="submit" value="7" name="timeframe">Days
        <input type="submit" value="14" name="timeframe">Days
        <input type="submit" value="30" name="timeframe">Days
        <input type="submit" value="60" name="timeframe">Days
        <input type="submit" value="90" name="timeframe">Days
        <input type="submit" value="100" name="timeframe">Days
    </form>
</div>

<div class="graphBox">
{% for graph in graphs %}

<div class="graph">
<canvas id="lineChart{{ graphs.index(graph) }}" width="900" height="400"></canvas>
<script>
    var ctx = document.getElementById("lineChart{{ graphs.index(graph) }}").getContext('2d')
    var lineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ graph[0] | safe }},
            datasets: [
                {
                    label: "{{ queries[graphs.index(graph)][0] }} Closing Price on Date",
                    data: {{ graph[1] | safe }},
                    fill: false,
                    borderColor: 'rgb(255,215,0)',
                    lineTension: 0.1
                }
            ]
        },
        options: {
            responsive: true
        }
    });
</script>
<form action="/delete" method="post">
    <input type="submit" name="delete" value="{{ queries[graphs.index(graph)][0] }}">Delete
</div>
{% endfor %}

</div>

{% endif %}

{% endblock %}